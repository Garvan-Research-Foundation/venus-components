"use strict";var se=Object.create;var d=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var me=(e,t)=>{for(var r in t)d(e,r,{get:t[r],enumerable:!0})},C=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ce(t))!pe.call(e,a)&&a!==r&&d(e,a,{get:()=>t[a],enumerable:!(n=ie(t,a))||n.enumerable});return e};var p=(e,t,r)=>(r=e!=null?se(ye(e)):{},C(t||!e||!e.__esModule?d(r,"default",{value:e,enumerable:!0}):r,e)),le=e=>C(d({},"__esModule",{value:!0}),e);var be={};me(be,{computeStorybookMetadata:()=>U,getStorybookMetadata:()=>E,metaFrameworks:()=>D,sanitizeAddonName:()=>T,telemetry:()=>ke});module.exports=le(be);var I=require("@storybook/client-logger");var z=p(require("read-pkg-up")),h=require("detect-package-manager"),m=require("@storybook/core-common");var F=p(require("path")),x=async e=>{let t=Object.keys(e);return Promise.all(t.map(S))},S=async e=>{try{let t=require(F.default.join(e,"package.json"));return{name:e,version:t.version}}catch{return{name:e,version:null}}};var g=p(require("fs-extra")),u=p(require("path")),W=require("@storybook/core-common"),L={Nx:"nx.json",Turborepo:"turbo.json",Lerna:"lerna.json",Rush:"rush.json",Lage:"lage.config.json"},Y=()=>{let e=(0,W.getProjectRoot)();if(!e)return;let r=Object.keys(L).find(a=>{let s=u.default.join(e,L[a]);return g.default.existsSync(s)});if(r)return r;if(!g.default.existsSync(u.default.join(e,"package.json")))return;let n=g.default.readJsonSync(u.default.join(e,"package.json"));if(n!=null&&n.workspaces)return"Workspaces"};var v=require("path");function _(e){return e.replace(/[-[/{}()*+?.\\^$|]/g,"\\$&")}function O(e,t=v.sep){if(!e)return e;let r=process.cwd().split(t);for(;r.length>1;){let n=r.join(t),a=new RegExp(_(n),"g");e=e.replace(a,"$SNIP");let s=r.join(t+t),c=new RegExp(_(s),"g");e=e.replace(c,"$SNIP"),r.pop()}return e}function k(e,t=v.sep){e=JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)));let r=O(JSON.stringify(e),t);return JSON.parse(r)}var D={next:"Next","react-scripts":"CRA",gatsby:"Gatsby","@nuxtjs/storybook":"nuxt","@nrwl/storybook":"nx","@vue/cli-service":"vue-cli","@sveltejs/kit":"svelte-kit"},fe=e=>{let t=["angular","ember","html","preact","react","server","svelte","vue","vue3","webComponents"].map(r=>`${r}Options`);for(let r of t)if(r in e)return e[r]},T=e=>O(e).replace(/\/dist\/.*/,"").replace(/\.[mc]?[tj]?s[x]?$/,"").replace(/\/register$/,"").replace(/\/manager$/,"").replace(/\/preset$/,""),U=async({packageJson:e,mainConfig:t})=>{var $,V;let r={generatedAt:new Date().getTime(),builder:{name:"webpack5"},hasCustomBabel:!1,hasCustomWebpack:!1,hasStaticDirs:!1,hasStorybookEslint:!1,refCount:0},n={...e==null?void 0:e.dependencies,...e==null?void 0:e.devDependencies,...e==null?void 0:e.peerDependencies},a=Object.keys(n).find(o=>!!D[o]);if(a){let{version:o}=await S(a);r.metaFramework={name:D[a],packageName:a,version:o}}let s=Y();s&&(r.monorepo=s);try{let o=await(0,h.detect)({cwd:(0,m.getProjectRoot)()}),i=await(0,h.getNpmVersion)(o);r.packageManager={type:o,version:i}}catch{}if(r.hasCustomBabel=!!t.babel,r.hasCustomWebpack=!!t.webpackFinal,r.hasStaticDirs=!!t.staticDirs,t.typescript&&(r.typescriptOptions=t.typescript),($=t.core)!=null&&$.builder){let{builder:o}=t.core;r.builder={name:typeof o=="string"?o:o.name,options:typeof o=="string"?void 0:(o==null?void 0:o.options)??void 0}}t.refs&&(r.refCount=Object.keys(t.refs).length),t.features&&(r.features=t.features);let c={};t.addons&&t.addons.forEach(o=>{let i,B;typeof o=="string"?i=T(o):(B=o.options,i=T(o.name)),c[i]={options:B,version:void 0}}),(await x(c)).forEach(({name:o,version:i})=>{c[o].version=i});let l=Object.keys(c),y=Object.keys(n).filter(o=>o.includes("storybook")&&!l.includes(o)).reduce((o,i)=>({...o,[i]:{version:void 0}}),{});(await x(y)).forEach(({name:o,version:i})=>{y[o].version=i});let oe=n.typescript?"typescript":"javascript",ne=!!n["eslint-plugin-storybook"],j=(0,m.getStorybookInfo)(e),ae=((V=y[j.frameworkPackage])==null?void 0:V.version)||j.version;return{...r,storybookVersion:ae,language:oe,storybookPackages:y,framework:{name:j.framework,options:fe(t)},addons:c,hasStorybookEslint:ne}},b,E=async e=>{var a;if(b)return b;let{packageJson:t={}}=z.default.sync({cwd:process.cwd(),normalize:!1})||{},r=(e||(0,m.getStorybookConfiguration)(((a=t==null?void 0:t.scripts)==null?void 0:a.storybook)||"","-c","--config-dir"))??".storybook",n=(0,m.loadMainConfig)({configDir:r});return b=await U({mainConfig:n,packageJson:t}),b};var Z=p(require("isomorphic-unfetch")),J=p(require("fetch-retry")),R=require("nanoid");var G=p(require("path")),K=require("child_process"),Q=require("@storybook/core-common");var H=require("crypto"),q=e=>{let t=(0,H.createHash)("sha256");return t.update("storybook-telemetry-salt"),t.update(e),t.digest("hex")};var P,X=()=>{if(P)return P;let e;try{let t=(0,Q.getProjectRoot)(),r=G.default.relative(t,process.cwd()),n=(0,K.execSync)("git config --local --get remote.origin.url",{timeout:1e3,stdio:"pipe"});e=`${String(n).trim()}${r}`,P=q(e)}catch{}return P};var de="https://storybook.js.org/event-log",ge=(0,J.default)(Z.default),w=[],ue=(0,R.nanoid)();async function ee(e,t={retryDelay:1e3,immediate:!1}){let{payload:r,metadata:n,...a}=e,s=t.stripMetadata?{}:{anonymousId:X(),inCI:Boolean(process.env.CI)},c=(0,R.nanoid)(),A={...a,eventId:c,sessionId:ue,metadata:n,payload:r,context:s},l;try{l=ge(de,{method:"POST",body:JSON.stringify(A),headers:{"Content-Type":"application/json"},retries:3,retryOn:[503,504],retryDelay:y=>2**y*(typeof(t==null?void 0:t.retryDelay)=="number"&&!Number.isNaN(t==null?void 0:t.retryDelay)?t.retryDelay:1e3)}),w.push(l),t.immediate?await Promise.all(w):await l}catch{}finally{w=w.filter(y=>y!==l)}}var M=p(require("chalk")),N=require("@storybook/core-common"),te="telemetry-notification-date",f=console,re=async()=>{await N.cache.get(te,null)||(N.cache.set(te,Date.now()),f.log(),f.log(`${M.default.magenta.bold("attention")} => Storybook now collects completely anonymous telemetry regarding usage.`),f.log("This information is used to shape Storybook's roadmap and prioritize features."),f.log("You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:"),f.log(M.default.cyan("https://storybook.js.org/telemetry")),f.log())};var ke=async(e,t={},r={})=>{var a;e!=="boot"&&await re();let n={eventType:e,payload:t};try{r!=null&&r.stripMetadata||(n.metadata=await E(r==null?void 0:r.configDir))}catch(s){n.payload.metadataErrorMessage=k(s).message,r!=null&&r.enableCrashReports&&(n.payload.metadataError=k(s))}finally{let{error:s}=n.payload;s&&(n.payload.error=k(s)),(!n.payload.error||(r==null?void 0:r.enableCrashReports))&&((a=process.env)!=null&&a.STORYBOOK_TELEMETRY_DEBUG&&(I.logger.info(`
[telemetry]`),I.logger.info(JSON.stringify(n,null,2))),await ee(n,r))}};0&&(module.exports={computeStorybookMetadata,getStorybookMetadata,metaFrameworks,sanitizeAddonName,telemetry});
